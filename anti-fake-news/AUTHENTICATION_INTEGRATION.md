# ğŸ” å‰ç«¯è®¤è¯ç³»ç»Ÿé›†æˆæ–‡æ¡£

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

æœ¬æ–‡æ¡£è®°å½•äº†å‰ç«¯ä¸åç«¯è®¤è¯ç³»ç»Ÿçš„å®Œæ•´é›†æˆï¼ŒåŒ…æ‹¬ç”¨æˆ·ç™»å½•ã€æ³¨å†Œã€æƒé™ç®¡ç†ç­‰åŠŸèƒ½ã€‚

---

## ğŸ¯ å®Œæˆçš„åŠŸèƒ½

### âœ… 1. ç±»å‹å®šä¹‰ (`src/types.ts`)
- **Role ç±»å‹**: `'READER' | 'MEMBER' | 'ADMIN'`
- **User æ¥å£**: åŒ…å« `id`, `email`, `name`, `imageUrl?`, `roles`
- **RegisterRequest**: æ³¨å†Œè¯·æ±‚æ•°æ®ç»“æ„
- **LoginRequest**: ç™»å½•è¯·æ±‚æ•°æ®ç»“æ„
- **AuthResponse**: è®¤è¯å“åº”ï¼ˆåŒ…å« JWT tokenï¼‰
- **ApiError**: API é”™è¯¯ç»“æ„

### âœ… 2. API æœåŠ¡ (`src/services/api.ts`)

#### è®¤è¯ API (`authService`)
```typescript
- register(data: RegisterRequest): Promise<AuthResponse>
  // ç”¨æˆ·æ³¨å†Œï¼Œè¿”å› JWT token

- login(data: LoginRequest): Promise<AuthResponse>
  // ç”¨æˆ·ç™»å½•ï¼Œè¿”å› JWT token

- getCurrentUser(): Promise<User>
  // è·å–å½“å‰ç™»å½•ç”¨æˆ·ä¿¡æ¯ï¼ˆéœ€è¦è®¤è¯ï¼‰

- logout(): void
  // æ¸…é™¤æœ¬åœ°å­˜å‚¨çš„ token å’Œç”¨æˆ·ä¿¡æ¯
```

#### ç®¡ç†å‘˜ API (`adminService`)
```typescript
- getAllUsers(): Promise<User[]>
  // è·å–æ‰€æœ‰ç”¨æˆ·åˆ—è¡¨ï¼ˆéœ€è¦ ADMIN æƒé™ï¼‰

- updateUserRole(userId: number, role: Role): Promise<string>
  // æ›´æ–°ç”¨æˆ·è§’è‰²ï¼ˆéœ€è¦ ADMIN æƒé™ï¼‰
```

#### å·¥å…·å‡½æ•° (`roleUtils`)
```typescript
- hasRole(user, role): boolean
  // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æ‹¥æœ‰æŒ‡å®šè§’è‰²

- isAdmin(user): boolean
  // æ£€æŸ¥æ˜¯å¦ä¸ºç®¡ç†å‘˜

- isMember(user): boolean
  // æ£€æŸ¥æ˜¯å¦ä¸ºä¼šå‘˜

- isAuthenticated(user): boolean
  // æ£€æŸ¥æ˜¯å¦å·²ç™»å½•
```

### âœ… 3. è®¤è¯çŠ¶æ€ç®¡ç† (`src/stores/auth.ts`)

#### State
```typescript
{
  user: User | null,          // å½“å‰ç”¨æˆ·ä¿¡æ¯
  token: string | null,       // JWT token
  loading: boolean,           // åŠ è½½çŠ¶æ€
  error: string | null        // é”™è¯¯ä¿¡æ¯
}
```

#### Getters
- `isAuthenticated`: æ˜¯å¦å·²ç™»å½•
- `isAdmin`: æ˜¯å¦ä¸ºç®¡ç†å‘˜
- `isMember`: æ˜¯å¦ä¸ºä¼šå‘˜
- `isReader`: æ˜¯å¦ä¸ºåªè¯»ç”¨æˆ·
- `displayName`: ç”¨æˆ·æ˜¾ç¤ºåç§°
- `avatarUrl`: ç”¨æˆ·å¤´åƒ URLï¼ˆå¸¦é»˜è®¤å€¼ï¼‰

#### Actions
- `register(data)`: ç”¨æˆ·æ³¨å†Œ
- `login(data)`: ç”¨æˆ·ç™»å½•
- `fetchCurrentUser()`: è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
- `logout()`: ç”¨æˆ·ç™»å‡º
- `restoreSession()`: ä» localStorage æ¢å¤ä¼šè¯
- `clearError()`: æ¸…é™¤é”™è¯¯ä¿¡æ¯

### âœ… 4. é¡µé¢ç»„ä»¶

#### ç™»å½•é¡µé¢ (`src/pages/Login.vue`)
- ğŸ“§ é‚®ç®± + å¯†ç ç™»å½•
- âœ… è¡¨å•éªŒè¯
- ğŸ”„ åŠ è½½çŠ¶æ€æç¤º
- âŒ é”™è¯¯ä¿¡æ¯å±•ç¤º
- ğŸ”— è·³è½¬åˆ°æ³¨å†Œé¡µé¢
- ğŸ’¡ æµ‹è¯•è´¦å·æç¤º

#### æ³¨å†Œé¡µé¢ (`src/pages/Register.vue`)
- ğŸ“ é‚®ç®±ã€åç§°ã€å¯†ç ã€ç¡®è®¤å¯†ç ã€å¤´åƒ URLï¼ˆå¯é€‰ï¼‰
- âœ… å®Œæ•´çš„è¡¨å•éªŒè¯ï¼ˆå¯†ç é•¿åº¦ã€å¯†ç ä¸€è‡´æ€§ï¼‰
- ğŸ”„ åŠ è½½çŠ¶æ€æç¤º
- âŒ é”™è¯¯ä¿¡æ¯å±•ç¤º
- ğŸ”— è·³è½¬åˆ°ç™»å½•é¡µé¢
- ğŸ’¡ é»˜è®¤è§’è‰²æç¤º

#### ç”¨æˆ·ç®¡ç†é¡µé¢ (`src/pages/AdminUsers.vue`)
- ğŸ‘¥ æ˜¾ç¤ºæ‰€æœ‰ç”¨æˆ·åˆ—è¡¨
- ğŸ·ï¸ æ˜¾ç¤ºç”¨æˆ·è§’è‰²æ ‡ç­¾
- ğŸ”„ æ›´æ–°ç”¨æˆ·è§’è‰²ï¼ˆREADERã€MEMBERã€ADMINï¼‰
- ğŸ” éœ€è¦ ADMIN æƒé™æ‰èƒ½è®¿é—®
- ğŸ“Š ç”¨æˆ·ä¿¡æ¯è¡¨æ ¼ï¼ˆIDã€å¤´åƒã€åç§°ã€é‚®ç®±ã€è§’è‰²ï¼‰
- ğŸ’¡ è§’è‰²è¯´æ˜æ–‡æ¡£

#### æŠ•ç¥¨é¡µé¢æ›´æ–° (`src/pages/VotePage.vue`)
- ğŸ‘¤ ä½¿ç”¨çœŸå®çš„ç™»å½•ç”¨æˆ·å
- ğŸ–¼ï¸ ä½¿ç”¨ç”¨æˆ·å¤´åƒä½œä¸ºé»˜è®¤å›¾ç‰‡
- ğŸ” éœ€è¦ç™»å½•æ‰èƒ½è®¿é—®

### âœ… 5. å¯¼èˆªæ ç»„ä»¶ (`src/components/NavBar.vue`)
- ğŸ  Logo å’Œæ ‡é¢˜
- ğŸ‘¤ æ˜¾ç¤ºå½“å‰ç”¨æˆ·ä¿¡æ¯ï¼ˆå¤´åƒã€åç§°ã€è§’è‰²ï¼‰
- ğŸ” ç™»å½•/æ³¨å†ŒæŒ‰é’®ï¼ˆæœªç™»å½•çŠ¶æ€ï¼‰
- ğŸšª é€€å‡ºç™»å½•æŒ‰é’®ï¼ˆå·²ç™»å½•çŠ¶æ€ï¼‰
- ğŸ‘¥ ç”¨æˆ·ç®¡ç†æŒ‰é’®ï¼ˆä»…ç®¡ç†å‘˜å¯è§ï¼‰
- ğŸ¨ è§’è‰²æ ‡ç­¾é¢œè‰²åŒºåˆ†

### âœ… 6. è·¯ç”±é…ç½® (`src/router/index.ts`)

#### æ–°å¢è·¯ç”±
```typescript
- /login          â†’ Login.vue (ä»…è®¿å®¢)
- /register       â†’ Register.vue (ä»…è®¿å®¢)
- /admin/users    â†’ AdminUsers.vue (éœ€è¦ ADMIN)
```

#### è·¯ç”±å®ˆå«
- âœ… è‡ªåŠ¨æ¢å¤ä¼šè¯ï¼ˆä» localStorageï¼‰
- âœ… æ£€æŸ¥ç™»å½•çŠ¶æ€ï¼ˆ`requiresAuth`ï¼‰
- âœ… æ£€æŸ¥ç®¡ç†å‘˜æƒé™ï¼ˆ`requiresAdmin`ï¼‰
- âœ… è®¿å®¢é¡µé¢é‡å®šå‘ï¼ˆ`guestOnly`ï¼‰
- âœ… ç™»å½•åè·³è½¬å›åŸé¡µé¢ï¼ˆ`redirect` queryï¼‰

### âœ… 7. åº”ç”¨æ ¹ç»„ä»¶ (`src/App.vue`)
- ğŸ§­ é›†æˆå¯¼èˆªæ ç»„ä»¶
- ğŸ“± å“åº”å¼å¸ƒå±€
- ğŸ¨ ä¿æŒåŸæœ‰æ ·å¼ç³»ç»Ÿ

---

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### è®¤è¯æµç¨‹

#### 1. æ³¨å†Œæµç¨‹
```
ç”¨æˆ·å¡«å†™è¡¨å• â†’ å‰ç«¯éªŒè¯ â†’ POST /auth/register
â†’ åç«¯è¿”å› token â†’ ä¿å­˜ token åˆ° localStorage
â†’ è‡ªåŠ¨è°ƒç”¨ GET /auth/me è·å–ç”¨æˆ·ä¿¡æ¯
â†’ è·³è½¬åˆ°é¦–é¡µ
```

#### 2. ç™»å½•æµç¨‹
```
ç”¨æˆ·å¡«å†™è¡¨å• â†’ å‰ç«¯éªŒè¯ â†’ POST /auth/login
â†’ åç«¯è¿”å› token â†’ ä¿å­˜ token åˆ° localStorage
â†’ è‡ªåŠ¨è°ƒç”¨ GET /auth/me è·å–ç”¨æˆ·ä¿¡æ¯
â†’ è·³è½¬åˆ°é¦–é¡µ
```

#### 3. ä¼šè¯æ¢å¤æµç¨‹
```
é¡µé¢åŠ è½½ â†’ è·¯ç”±å®ˆå«æ£€æŸ¥ localStorage ä¸­çš„ token
â†’ å¦‚æœå­˜åœ¨ token ä½†æ— ç”¨æˆ·ä¿¡æ¯
â†’ è°ƒç”¨ GET /auth/me æ¢å¤ç”¨æˆ·ä¿¡æ¯
â†’ å¦‚æœå¤±è´¥åˆ™æ¸…é™¤ token
```

#### 4. æƒé™éªŒè¯æµç¨‹
```
ç”¨æˆ·è®¿é—®é¡µé¢ â†’ è·¯ç”±å®ˆå«æ£€æŸ¥ meta ä¿¡æ¯
â†’ requiresAuth: æ£€æŸ¥æ˜¯å¦ç™»å½•
â†’ requiresAdmin: æ£€æŸ¥æ˜¯å¦ä¸ºç®¡ç†å‘˜
â†’ guestOnly: å·²ç™»å½•ç”¨æˆ·é‡å®šå‘åˆ°é¦–é¡µ
```

### API æ‹¦æˆªå™¨

#### è¯·æ±‚æ‹¦æˆª
```typescript
// è‡ªåŠ¨æ·»åŠ  Authorization header
headers: {
  'Content-Type': 'application/json',
  'Authorization': `Bearer ${token}`
}
```

#### å“åº”æ‹¦æˆª
```typescript
// 401: Token è¿‡æœŸ/æ— æ•ˆ â†’ æ¸…é™¤ token â†’ è·³è½¬ç™»å½•é¡µ
// 403: æƒé™ä¸è¶³ â†’ æç¤ºç”¨æˆ·
```

---

## ğŸ¨ UI/UX ç‰¹æ€§

### 1. è§’è‰²é¢œè‰²æ ‡è¯†
- **ADMIN**: ğŸ”´ çº¢è‰²ï¼ˆ`bg-red-100 text-red-800`ï¼‰
- **MEMBER**: ğŸ”µ è“è‰²ï¼ˆ`bg-blue-100 text-blue-800`ï¼‰
- **READER**: âšª ç°è‰²ï¼ˆ`bg-gray-100 text-gray-800`ï¼‰

### 2. ç”¨æˆ·å¤´åƒ
- ä¼˜å…ˆä½¿ç”¨ç”¨æˆ·ä¸Šä¼ çš„å¤´åƒ URL
- é»˜è®¤ä½¿ç”¨ UI Avatars API ç”Ÿæˆå¤´åƒ
- æ˜¾ç¤ºç”¨æˆ·åé¦–å­—æ¯

### 3. åŠ è½½çŠ¶æ€
- è¡¨å•æäº¤æ—¶æ˜¾ç¤ºåŠ è½½åŠ¨ç”»
- ç¦ç”¨æŒ‰é’®é˜²æ­¢é‡å¤æäº¤
- å‹å¥½çš„åŠ è½½æ–‡æœ¬æç¤º

### 4. é”™è¯¯å¤„ç†
- çº¢è‰²è¾¹æ¡†é«˜äº®é”™è¯¯å­—æ®µ
- é”™è¯¯ä¿¡æ¯æ˜¾ç¤ºåœ¨è¡¨å•ä¸Šæ–¹
- ç½‘ç»œé”™è¯¯å‹å¥½æç¤º

---

## ğŸ“‚ æ–‡ä»¶ç»“æ„

```
src/
â”œâ”€â”€ services/
â”‚   â””â”€â”€ api.ts                 # API æœåŠ¡å°è£…
â”œâ”€â”€ stores/
â”‚   â”œâ”€â”€ auth.ts                # è®¤è¯çŠ¶æ€ç®¡ç†
â”‚   â””â”€â”€ comments.ts            # è¯„è®ºçŠ¶æ€ç®¡ç†ï¼ˆå·²å­˜åœ¨ï¼‰
â”œâ”€â”€ pages/
â”‚   â”œâ”€â”€ Login.vue              # ç™»å½•é¡µé¢ âœ¨ æ–°å¢
â”‚   â”œâ”€â”€ Register.vue           # æ³¨å†Œé¡µé¢ âœ¨ æ–°å¢
â”‚   â”œâ”€â”€ AdminUsers.vue         # ç”¨æˆ·ç®¡ç†é¡µé¢ âœ¨ æ–°å¢
â”‚   â”œâ”€â”€ VotePage.vue           # æŠ•ç¥¨é¡µé¢ âœ… å·²æ›´æ–°
â”‚   â”œâ”€â”€ Home.vue               # é¦–é¡µï¼ˆå·²å­˜åœ¨ï¼‰
â”‚   â””â”€â”€ NewsDetails.vue        # æ–°é—»è¯¦æƒ…ï¼ˆå·²å­˜åœ¨ï¼‰
â”œâ”€â”€ components/
â”‚   â””â”€â”€ NavBar.vue             # å¯¼èˆªæ ç»„ä»¶ âœ¨ æ–°å¢
â”œâ”€â”€ router/
â”‚   â””â”€â”€ index.ts               # è·¯ç”±é…ç½® âœ… å·²æ›´æ–°
â”œâ”€â”€ types.ts                   # ç±»å‹å®šä¹‰ âœ… å·²æ›´æ–°
â””â”€â”€ App.vue                    # æ ¹ç»„ä»¶ âœ… å·²æ›´æ–°
```

---

## ğŸ”‘ å…³é”®ä»£ç ç¤ºä¾‹

### 1. å¦‚ä½•æ£€æŸ¥ç”¨æˆ·è§’è‰²

```typescript
import { useAuthStore } from '@/stores/auth'

const authStore = useAuthStore()

// æ£€æŸ¥æ˜¯å¦å·²ç™»å½•
if (authStore.isAuthenticated) {
  // ç”¨æˆ·å·²ç™»å½•
}

// æ£€æŸ¥æ˜¯å¦ä¸ºç®¡ç†å‘˜
if (authStore.isAdmin) {
  // æ˜¾ç¤ºç®¡ç†å‘˜åŠŸèƒ½
}

// æ£€æŸ¥æ˜¯å¦ä¸ºä¼šå‘˜
if (authStore.isMember) {
  // å…è®¸å‘å¸ƒå†…å®¹
}
```

### 2. å¦‚ä½•è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯

```typescript
import { useAuthStore } from '@/stores/auth'

const authStore = useAuthStore()

// è·å–ç”¨æˆ·å¯¹è±¡
const user = authStore.user
// { id: 1, email: '...', name: '...', roles: [...] }

// è·å–æ˜¾ç¤ºåç§°
const name = authStore.displayName

// è·å–å¤´åƒ URL
const avatar = authStore.avatarUrl
```

### 3. å¦‚ä½•è°ƒç”¨ API

```typescript
import { authService, adminService } from '@/services/api'

// ç™»å½•
try {
  await authStore.login({ email, password })
  router.push('/')
} catch (error) {
  console.error(error.message)
}

// è·å–æ‰€æœ‰ç”¨æˆ·ï¼ˆç®¡ç†å‘˜ï¼‰
try {
  const users = await adminService.getAllUsers()
  console.log(users)
} catch (error) {
  console.error(error.message)
}
```

---

## ğŸš€ ä½¿ç”¨è¯´æ˜

### å¯åŠ¨é¡¹ç›®

```bash
# å¯åŠ¨å‰ç«¯å¼€å‘æœåŠ¡å™¨
npm run dev

# å¯åŠ¨ JSON Server (è¯„è®ºæ•°æ®)
npm run api

# åŒæ—¶å¯åŠ¨ä¸¤è€…
npm run start:all
```

### æµ‹è¯•è´¦å·

```
ç®¡ç†å‘˜:
é‚®ç®±: admin@local
å¯†ç : admin123
```

### è®¿é—®é¡µé¢

- é¦–é¡µ: http://localhost:5173/
- ç™»å½•: http://localhost:5173/login
- æ³¨å†Œ: http://localhost:5173/register
- ç”¨æˆ·ç®¡ç†: http://localhost:5173/admin/users (éœ€è¦ ADMIN)

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. åç«¯æœåŠ¡
ç¡®ä¿åç«¯æœåŠ¡è¿è¡Œåœ¨ `http://localhost:8080`

### 2. Token å­˜å‚¨
- Token å­˜å‚¨åœ¨ `localStorage` ä¸­
- ç”¨æˆ·ä¿¡æ¯ç¼“å­˜åœ¨ `localStorage` ä¸­
- é€€å‡ºç™»å½•æ—¶è‡ªåŠ¨æ¸…é™¤

### 3. ä¼šè¯æ¢å¤
- åˆ·æ–°é¡µé¢ä¼šè‡ªåŠ¨æ¢å¤ç™»å½•çŠ¶æ€
- Token æœ‰æ•ˆæœŸä¸º 24 å°æ—¶
- è¿‡æœŸåéœ€è¦é‡æ–°ç™»å½•

### 4. æƒé™æ§åˆ¶
- `/vote/:id` éœ€è¦ç™»å½•æ‰èƒ½è®¿é—®
- `/admin/users` éœ€è¦ ADMIN è§’è‰²
- `/login` å’Œ `/register` å·²ç™»å½•ç”¨æˆ·æ— æ³•è®¿é—®

### 5. ä»£ç ä¼˜åŒ–
- âœ… é¿å…é‡å¤è°ƒç”¨ `restoreSession()`
- âœ… åªåœ¨è·¯ç”±å®ˆå«ä¸­æ¢å¤ä¼šè¯
- âœ… ç§»é™¤ App.vue ä¸­çš„é‡å¤è°ƒç”¨

---

## ğŸ”„ ä¸åç«¯çš„å­—æ®µå¯¹åº”

### User å®ä½“
| åç«¯å­—æ®µ | å‰ç«¯å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|---------|---------|------|------|
| `id` | `id` | `number` | ç”¨æˆ· ID |
| `email` | `email` | `string` | é‚®ç®±ï¼ˆç™»å½•å‡­è¯ï¼‰ |
| `name` | `name` | `string` | æ˜¾ç¤ºåç§° |
| `imageUrl` | `imageUrl` | `string?` | å¤´åƒ URLï¼ˆå¯é€‰ï¼‰ |
| `roles` | `roles` | `Role[]` | è§’è‰²æ•°ç»„ |

### è®¤è¯å“åº”
| åç«¯å­—æ®µ | å‰ç«¯å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|---------|---------|------|------|
| `token` | `token` | `string` | JWT token |

### æ³¨æ„
âœ… **å®Œå…¨åŒ¹é…**: ä½¿ç”¨é©¼å³°å‘½åï¼ˆ`imageUrl`ï¼‰è€Œä¸æ˜¯ä¸‹åˆ’çº¿ï¼ˆ`image_url`ï¼‰

---

## ğŸ“ TODOï¼ˆå¯é€‰ä¼˜åŒ–ï¼‰

- [ ] æ·»åŠ  Token è‡ªåŠ¨åˆ·æ–°æœºåˆ¶
- [ ] æ·»åŠ "è®°ä½æˆ‘"åŠŸèƒ½
- [ ] å®ç°å¯†ç å¼ºåº¦æ£€æµ‹
- [ ] æ·»åŠ "å¿˜è®°å¯†ç "åŠŸèƒ½
- [ ] æ·»åŠ é‚®ç®±éªŒè¯åŠŸèƒ½
- [ ] ä¼˜åŒ–é”™è¯¯æç¤ºï¼ˆå¤šè¯­è¨€æ”¯æŒï¼‰
- [ ] æ·»åŠ ç”¨æˆ·èµ„æ–™ç¼–è¾‘é¡µé¢
- [ ] å®ç°æ›´ç»†ç²’åº¦çš„æƒé™æ§åˆ¶

---

## ğŸ‰ æ€»ç»“

æœ¬æ¬¡é›†æˆå®Œæˆäº†ä»¥ä¸‹æ ¸å¿ƒåŠŸèƒ½ï¼š

1. âœ… å®Œæ•´çš„ç”¨æˆ·è®¤è¯ç³»ç»Ÿï¼ˆç™»å½•ã€æ³¨å†Œã€ç™»å‡ºï¼‰
2. âœ… åŸºäºè§’è‰²çš„æƒé™æ§åˆ¶ï¼ˆREADERã€MEMBERã€ADMINï¼‰
3. âœ… è·¯ç”±å®ˆå«å’Œä¼šè¯ç®¡ç†
4. âœ… ç”¨æˆ·ç®¡ç†ç•Œé¢ï¼ˆç®¡ç†å‘˜åŠŸèƒ½ï¼‰
5. âœ… å“åº”å¼å¯¼èˆªæ å’Œç”¨æˆ·ä¿¡æ¯å±•ç¤º
6. âœ… ä¸åç«¯ API å®Œå…¨å¯¹æ¥
7. âœ… ä¼˜åŒ–ä»£ç ï¼Œé¿å…é‡å¤è°ƒç”¨

æ‰€æœ‰ä»£ç éƒ½éµå¾ª Vue 3 + TypeScript + Pinia æœ€ä½³å®è·µï¼Œå¹¶ä¸åç«¯å­—æ®µå®Œå…¨åŒ¹é…ï¼ğŸš€
